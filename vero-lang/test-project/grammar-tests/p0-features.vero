# P0 Feature Test - Test Annotations, Serial, URL/Title, Upload
# Updated to PAGEACTIONS Pattern

PAGE LoginPage {
    FIELD emailInput = "Email"
    FIELD loginButton = "Login"
}

PAGE FormPage {
    FIELD emailField = "#email"
    FIELD items = ".items"
    FIELD link = "#link"
}

PAGE UploadPage {
    FIELD fileInput = "#fileInput"
    FIELD multiUpload = "#multiUpload"
    FIELD submitBtn = "Submit"
    FIELD uploadAllBtn = "Upload All"
    FIELD uploadedCount = ".uploaded-count"
    FIELD successMessage = "Upload successful"
}

PAGEACTIONS LoginPageActions FOR LoginPage {
    enterEmail WITH value {
        FILL emailInput WITH value
    }

    clickLogin {
        CLICK loginButton
    }

    login WITH email {
        FILL emailInput WITH email
        CLICK loginButton
    }
}

PAGEACTIONS FormPageActions FOR FormPage {
    getEmailValue RETURNS TEXT {
        RETURN VALUE OF emailField
    }

    getItemCount RETURNS NUMBER {
        RETURN COUNT OF items
    }

    isEmailVisible RETURNS FLAG {
        RETURN VISIBLE OF emailField
    }
}

PAGEACTIONS UploadPageActions FOR UploadPage {
    uploadFile WITH filePath {
        UPLOAD filePath TO fileInput
    }

    uploadMultipleFiles WITH files {
        UPLOAD files TO multiUpload
    }

    clickSubmit {
        CLICK submitBtn
    }

    clickUploadAll {
        CLICK uploadAllBtn
    }

    isSuccessVisible RETURNS FLAG {
        RETURN VISIBLE OF successMessage
    }

    getUploadedCount RETURNS NUMBER {
        RETURN COUNT OF uploadedCount
    }
}

# Feature with @serial annotation - tests run sequentially
@serial
FEATURE SerialLoginTests {
    USE LoginPageActions

    SCENARIO FirstLoginTest @smoke {
        OPEN "https://example.com/login"
        PERFORM LoginPageActions.login WITH "user1@test.com"
        VERIFY URL CONTAINS "/dashboard"
        VERIFY TITLE EQUAL "Dashboard"
    }

    SCENARIO SecondLoginTest {
        OPEN "https://example.com/login"
        PERFORM LoginPageActions.login WITH "user2@test.com"
        VERIFY URL EQUAL "https://example.com/dashboard"
        VERIFY TITLE CONTAINS "Dashboard"
    }
}

# Feature with @skip annotation - entire feature skipped
@skip
FEATURE SkippedFeature {
    SCENARIO ThisTestWillBeSkipped {
        OPEN "https://example.com"
    }
}

# Feature with @only annotation - only this feature runs
@only
FEATURE FocusedFeature {
    SCENARIO ThisRuns {
        OPEN "https://example.com"
    }
}

# Feature with scenario-level annotations
FEATURE TestAnnotations {
    # @skip - this scenario is skipped
    @skip
    SCENARIO SkippedTest {
        OPEN "https://example.com"
        # This never runs
    }

    # @only - run only this test
    @only
    SCENARIO FocusedTest @smoke @regression {
        OPEN "https://example.com"
        VERIFY "Welcome" IS VISIBLE
    }

    # @slow - triple the timeout
    @slow
    SCENARIO SlowTest {
        OPEN "https://example.com/large-page"
        WAIT 5 SECONDS
        VERIFY "Loaded" IS VISIBLE
    }

    # @fixme - mark as known issue
    @fixme
    SCENARIO KnownIssueTest {
        OPEN "https://example.com/buggy"
        # Known to fail, marked as fixme
    }
}

# Feature testing URL and Title assertions
FEATURE UrlTitleAssertions {
    USE FormPageActions

    SCENARIO VerifyUrlPatterns {
        OPEN "https://example.com/dashboard/users"
        VERIFY URL CONTAINS "/dashboard"
        VERIFY URL EQUAL "https://example.com/dashboard/users"
        VERIFY URL MATCHES ".*dashboard.*"
    }

    SCENARIO VerifyTitlePatterns {
        OPEN "https://example.com"
        VERIFY TITLE EQUAL "Example Domain"
        VERIFY TITLE CONTAINS "Example"
    }

    SCENARIO VerifyElementHasProperties {
        OPEN "https://example.com/form"

        TEXT emailValue = PERFORM FormPageActions.getEmailValue
        VERIFY emailValue EQUAL "test@example.com"

        NUMBER itemCount = PERFORM FormPageActions.getItemCount
        VERIFY itemCount IS 5
    }
}

# Feature testing file upload
FEATURE FileUpload {
    USE UploadPageActions

    SCENARIO SingleFileUpload {
        OPEN "https://example.com/upload"
        PERFORM UploadPageActions.uploadFile WITH "test-files/document.pdf"
        PERFORM UploadPageActions.clickSubmit

        FLAG isSuccess = PERFORM UploadPageActions.isSuccessVisible
        VERIFY isSuccess IS TRUE
    }

    SCENARIO MultipleFileUpload {
        OPEN "https://example.com/gallery"
        PERFORM UploadPageActions.uploadMultipleFiles WITH "images/photo1.jpg", "images/photo2.jpg", "images/photo3.jpg"
        PERFORM UploadPageActions.clickUploadAll

        NUMBER count = PERFORM UploadPageActions.getUploadedCount
        VERIFY count IS 3
    }
}
