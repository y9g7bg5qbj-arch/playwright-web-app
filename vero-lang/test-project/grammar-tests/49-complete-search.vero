# Test: Complete Search Functionality
# Category: Integration - Search (New PAGEACTIONS Pattern)

PAGE SearchPage {
    FIELD searchInput = "#search-input"
    FIELD searchBtn = "Search"
    FIELD results = ".search-results"
    FIELD resultItem = ".result-item"
    FIELD noResults = ".no-results"
    FIELD loadMore = "Load More"
    FIELD filterCategory = "#category-filter"
    FIELD filterPrice = "#price-filter"
    FIELD sortDropdown = "#sort-by"
}

PAGEACTIONS SearchPageActions FOR SearchPage {
    enterSearchQuery WITH query {
        FILL searchInput WITH query
    }

    clickSearch {
        CLICK searchBtn
    }

    doSearch WITH query {
        FILL searchInput WITH query
        CLICK searchBtn
        WAIT 2 SECONDS
    }

    clearSearch {
        CLEAR searchInput
    }

    applyFilter WITH category {
        SELECT category FROM filterCategory
        WAIT 1 SECONDS
    }

    sortBy WITH opt {
        SELECT opt FROM sortDropdown
        WAIT 1 SECONDS
    }

    clickLoadMore {
        CLICK loadMore
    }

    awaitSearchPage {
        WAIT FOR searchInput
    }
}

FEATURE SearchFunctionality {

    BEFORE EACH {
        OPEN "/search"
        WAIT 1 SECONDS
    }

    SCENARIO BasicSearch @smoke {
        PERFORM SearchPageActions.doSearch WITH "laptop"

        VERIFY SearchPage.results IS VISIBLE
        VERIFY SearchPage.resultItem IS VISIBLE
    }

    SCENARIO NoResults @regression {
        PERFORM SearchPageActions.doSearch WITH "xyznonexistent123456"

        VERIFY SearchPage.noResults IS VISIBLE
        VERIFY SearchPage.results IS HIDDEN
    }

    SCENARIO SearchWithFilter @regression {
        PERFORM SearchPageActions.doSearch WITH "phone"
        PERFORM SearchPageActions.applyFilter WITH "Electronics"

        VERIFY SearchPage.results IS VISIBLE
    }

    SCENARIO SearchWithSort @regression {
        PERFORM SearchPageActions.doSearch WITH "tablet"
        PERFORM SearchPageActions.sortBy WITH "Price: Low to High"

        VERIFY SearchPage.results IS VISIBLE
    }

    SCENARIO ClearAndNewSearch @regression {
        PERFORM SearchPageActions.doSearch WITH "keyboard"

        VERIFY SearchPage.results IS VISIBLE

        PERFORM SearchPageActions.clearSearch
        PERFORM SearchPageActions.doSearch WITH "mouse"

        VERIFY SearchPage.results IS VISIBLE
    }

    SCENARIO Pagination @regression {
        PERFORM SearchPageActions.doSearch WITH "accessories"

        REPEAT 3 TIMES {
            SCROLL DOWN
            WAIT 1 SECONDS
        }

        IF SearchPage.loadMore IS VISIBLE {
            PERFORM SearchPageActions.clickLoadMore
            WAIT 2 SECONDS
        }

        VERIFY SearchPage.results IS VISIBLE
    }
}
