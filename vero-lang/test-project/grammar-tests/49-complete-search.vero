# Test: Complete Search Functionality
# Category: Integration - Search (New PAGEACTIONS Pattern)

PAGE SearchPage {
    FIELD searchInput = "#search-input"
    FIELD searchBtn = "Search"
    FIELD results = ".search-results"
    FIELD resultItem = ".result-item"
    FIELD noResults = ".no-results"
    FIELD loadMore = "Load More"
    FIELD filterCategory = "#category-filter"
    FIELD filterPrice = "#price-filter"
    FIELD sortDropdown = "#sort-by"
}

PAGEACTIONS SearchPageActions FOR SearchPage {
    enterSearchQuery WITH query {
        FILL searchInput WITH query
    }

    clickSearch {
        CLICK searchBtn
    }

    search WITH query {
        FILL searchInput WITH query
        CLICK searchBtn
        WAIT 2 SECONDS
    }

    clearSearch {
        CLEAR searchInput
    }

    applyFilter WITH category {
        SELECT category FROM filterCategory
        WAIT 1 SECONDS
    }

    sortBy WITH option {
        SELECT option FROM sortDropdown
        WAIT 1 SECONDS
    }

    clickLoadMore {
        CLICK loadMore
    }

    isResultsVisible RETURNS FLAG {
        RETURN VISIBLE OF results
    }

    isResultItemVisible RETURNS FLAG {
        RETURN VISIBLE OF resultItem
    }

    isNoResultsVisible RETURNS FLAG {
        RETURN VISIBLE OF noResults
    }

    isLoadMoreVisible RETURNS FLAG {
        RETURN VISIBLE OF loadMore
    }

    awaitSearchPage {
        WAIT FOR searchInput
    }
}

FEATURE SearchFunctionality {
    USE SearchPageActions

    BEFORE EACH {
        OPEN "/search"
        WAIT 1 SECONDS
    }

    SCENARIO BasicSearch @smoke {
        PERFORM SearchPageActions.search WITH "laptop"

        FLAG hasResults = PERFORM SearchPageActions.isResultsVisible
        VERIFY hasResults IS TRUE

        FLAG hasItems = PERFORM SearchPageActions.isResultItemVisible
        VERIFY hasItems IS TRUE
    }

    SCENARIO NoResults @regression {
        PERFORM SearchPageActions.search WITH "xyznonexistent123456"

        FLAG noResults = PERFORM SearchPageActions.isNoResultsVisible
        VERIFY noResults IS TRUE

        FLAG hasResults = PERFORM SearchPageActions.isResultsVisible
        VERIFY hasResults IS NOT TRUE
    }

    SCENARIO SearchWithFilter @regression {
        PERFORM SearchPageActions.search WITH "phone"
        PERFORM SearchPageActions.applyFilter WITH "Electronics"

        FLAG hasResults = PERFORM SearchPageActions.isResultsVisible
        VERIFY hasResults IS TRUE
    }

    SCENARIO SearchWithSort @regression {
        PERFORM SearchPageActions.search WITH "tablet"
        PERFORM SearchPageActions.sortBy WITH "Price: Low to High"

        FLAG hasResults = PERFORM SearchPageActions.isResultsVisible
        VERIFY hasResults IS TRUE
    }

    SCENARIO ClearAndNewSearch @regression {
        PERFORM SearchPageActions.search WITH "keyboard"

        FLAG hasResults = PERFORM SearchPageActions.isResultsVisible
        VERIFY hasResults IS TRUE

        PERFORM SearchPageActions.clearSearch
        PERFORM SearchPageActions.search WITH "mouse"

        FLAG hasNewResults = PERFORM SearchPageActions.isResultsVisible
        VERIFY hasNewResults IS TRUE
    }

    SCENARIO Pagination @regression {
        PERFORM SearchPageActions.search WITH "accessories"

        REPEAT 3 TIMES {
            SCROLL DOWN
            WAIT 1 SECONDS
        }

        FLAG hasLoadMore = PERFORM SearchPageActions.isLoadMoreVisible
        IF hasLoadMore IS TRUE {
            PERFORM SearchPageActions.clickLoadMore
            WAIT 2 SECONDS
        }

        FLAG hasResults = PERFORM SearchPageActions.isResultsVisible
        VERIFY hasResults IS TRUE
    }
}
