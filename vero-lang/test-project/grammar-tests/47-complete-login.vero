# Test: Complete Login Flow
# Category: Integration - Login (Inline Actions)

PAGE LoginPage {
    FIELD emailInput = "input[type='email']"
    FIELD passwordInput = "input[type='password']"
    FIELD submitBtn = "button[type='submit']"
    FIELD errorMsg = ".error-message"
    FIELD rememberMe = "#remember"

    enterEmail WITH val {
        FILL emailInput WITH val
    }

    enterPassword WITH val {
        FILL passwordInput WITH val
    }

    clickSubmit {
        CLICK submitBtn
    }

    checkRememberMe {
        CHECK rememberMe
    }

    doLogin WITH email, password {
        FILL emailInput WITH email
        FILL passwordInput WITH password
        CLICK submitBtn
    }

    loginWithRemember WITH email, password {
        FILL emailInput WITH email
        FILL passwordInput WITH password
        CHECK rememberMe
        CLICK submitBtn
    }

    getErrorText RETURNS TEXT {
        RETURN errorMsg
    }

    getEmailValue RETURNS TEXT {
        RETURN emailInput
    }

    awaitLoginPage {
        WAIT FOR emailInput
    }
}

PAGE DashboardPage {
    FIELD header = ".dashboard-header"
    FIELD welcomeMsg = ".welcome-message"
    FIELD logoutBtn = "Logout"

    clickLogout {
        CLICK logoutBtn
    }

    doLogout {
        CLICK logoutBtn
        WAIT 1 SECONDS
    }

    getWelcomeText RETURNS TEXT {
        RETURN welcomeMsg
    }

    awaitDashboard {
        WAIT FOR header
    }
}

FEATURE UserAuthentication {

    BEFORE EACH {
        OPEN "/login"
        WAIT 1 SECONDS
    }

    AFTER EACH {
        TAKE SCREENSHOT "test-result"
    }

    SCENARIO ValidLogin @smoke @critical {
        PERFORM LoginPage.doLogin WITH "admin@example.com", "password123"
        WAIT 2 SECONDS

        VERIFY DashboardPage.header IS VISIBLE

        TEXT welcomeText = DashboardPage.getWelcomeText
        VERIFY welcomeText IS CONTAINS "Welcome"
    }

    SCENARIO InvalidCredentials @regression {
        PERFORM LoginPage.doLogin WITH "invalid@example.com", "wrongpassword"

        VERIFY LoginPage.errorMsg IS VISIBLE

        TEXT errorText = LoginPage.getErrorText
        VERIFY errorText IS CONTAINS "Invalid"
    }

    SCENARIO EmptyCredentials @regression {
        PERFORM LoginPage.clickSubmit

        VERIFY LoginPage.errorMsg IS VISIBLE
    }

    SCENARIO RememberMe @regression {
        PERFORM LoginPage.loginWithRemember WITH "user@example.com", "password"

        VERIFY DashboardPage.header IS VISIBLE

        PERFORM DashboardPage.doLogout

        TEXT emailValue = LoginPage.getEmailValue
        VERIFY emailValue IS CONTAINS "user@example.com"
    }
}
