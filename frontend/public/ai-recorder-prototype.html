<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test Recorder - Interactive Prototype v2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0f;
            color: #e4e4e7;
            height: 100vh;
            overflow: hidden;
        }

        /* Toolbar */
        .toolbar {
            height: 48px;
            background: linear-gradient(180deg, #18181b 0%, #131316 100%);
            border-bottom: 1px solid #27272a;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 12px;
        }

        .toolbar-title {
            font-size: 14px;
            font-weight: 600;
            color: #a78bfa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toolbar-title svg {
            width: 20px;
            height: 20px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #27272a;
            color: #a1a1aa;
            border: 1px solid #3f3f46;
        }

        .btn-secondary:hover {
            background: #3f3f46;
            color: #e4e4e7;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .toolbar-spacer {
            flex: 1;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-idle {
            background: #27272a;
            color: #71717a;
        }

        .status-running {
            background: #1e3a5f;
            color: #60a5fa;
        }

        .status-success {
            background: #14532d;
            color: #4ade80;
        }

        .status-replace {
            background: #4c1d95;
            color: #c4b5fd;
        }

        .pulse {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        /* Main Content */
        .main-content {
            display: flex;
            height: calc(100vh - 48px);
        }

        /* Left Panel - Browser */
        .browser-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #27272a;
        }

        .browser-header {
            height: 40px;
            background: #18181b;
            border-bottom: 1px solid #27272a;
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 8px;
        }

        .browser-dots {
            display: flex;
            gap: 6px;
        }

        .browser-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-red {
            background: #ef4444;
        }

        .dot-yellow {
            background: #eab308;
        }

        .dot-green {
            background: #22c55e;
        }

        .url-bar {
            flex: 1;
            background: #0a0a0f;
            border: 1px solid #3f3f46;
            border-radius: 6px;
            padding: 6px 12px;
            color: #a1a1aa;
            font-size: 12px;
            margin-left: 12px;
        }

        .browser-viewport {
            flex: 1;
            background: #f8fafc;
            position: relative;
            overflow: hidden;
        }

        .browser-viewport.replace-mode {
            cursor: crosshair;
        }

        .browser-viewport.replace-mode::after {
            content: 'CLICK ON ELEMENT TO REPLACE STEP';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: #8b5cf6;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 100;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            50% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        /* Mock Website */
        .mock-site {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .mock-logo {
            font-size: 28px;
            font-weight: 700;
            color: #8b5cf6;
            margin-bottom: 40px;
        }

        .mock-form {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 32px;
            width: 360px;
        }

        .mock-form h2 {
            color: #f1f5f9;
            font-size: 20px;
            margin-bottom: 24px;
            text-align: center;
        }

        .mock-input,
        .mock-btn,
        .mock-link {
            transition: all 0.2s;
        }

        .mock-input {
            width: 100%;
            padding: 12px 16px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 14px;
            margin-bottom: 16px;
        }

        .mock-input:hover,
        .mock-input.hoverable:hover {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .mock-input.highlight {
            border-color: #22c55e;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
            animation: highlightPulse 0.5s;
        }

        @keyframes highlightPulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        .mock-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .mock-btn:hover,
        .mock-btn.hoverable:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
            border-color: #c4b5fd;
        }

        .mock-btn.highlight {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }

        .mock-link {
            display: block;
            text-align: center;
            color: #8b5cf6;
            font-size: 13px;
            margin-top: 16px;
            cursor: pointer;
            border: 2px solid transparent;
            padding: 4px;
            border-radius: 4px;
        }

        .mock-link:hover,
        .mock-link.hoverable:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        /* AI Cursor */
        .ai-cursor {
            position: absolute;
            width: 24px;
            height: 24px;
            pointer-events: none;
            z-index: 1000;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }

        .ai-cursor.visible {
            opacity: 1;
        }

        .ai-cursor svg {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .ai-cursor-label {
            position: absolute;
            top: 28px;
            left: 0;
            background: #8b5cf6;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            font-weight: 500;
        }

        /* Right Panel - Test Cases */
        .tests-panel {
            width: 420px;
            background: #131316;
            display: flex;
            flex-direction: column;
            transition: width 0.3s;
        }

        .tests-panel.collapsed {
            width: 0;
            overflow: hidden;
        }

        .tests-header {
            height: 48px;
            background: #18181b;
            border-bottom: 1px solid #27272a;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
        }

        .tests-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: #e4e4e7;
        }

        .close-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: #71717a;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #27272a;
            color: #e4e4e7;
        }

        .tests-list {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        /* Test Case Card */
        .test-card {
            background: #1c1c21;
            border: 1px solid #27272a;
            border-radius: 8px;
            margin-bottom: 8px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .test-card:hover {
            border-color: #3f3f46;
        }

        .test-card.active {
            border-color: #8b5cf6;
        }

        .test-card-header {
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .test-status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .status-pending {
            background: #27272a;
            color: #71717a;
        }

        .status-running-icon {
            background: #1e3a5f;
            color: #60a5fa;
        }

        .status-complete {
            background: #14532d;
            color: #4ade80;
        }

        .status-failed {
            background: #7f1d1d;
            color: #f87171;
        }

        .test-card-title {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }

        .expand-icon {
            color: #71717a;
            transition: transform 0.2s;
        }

        .test-card.expanded .expand-icon {
            transform: rotate(90deg);
        }

        /* Test Steps */
        .test-steps {
            display: none;
            border-top: 1px solid #27272a;
            padding: 8px;
        }

        .test-card.expanded .test-steps {
            display: block;
        }

        /* ADD STEP BUTTON (between steps) */
        .add-step-row {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px 0;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .test-steps:hover .add-step-row {
            opacity: 1;
        }

        .add-step-btn {
            width: 100%;
            padding: 6px;
            border: 1px dashed #3f3f46;
            border-radius: 6px;
            background: transparent;
            color: #71717a;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .add-step-btn:hover {
            border-color: #8b5cf6;
            color: #a78bfa;
            background: rgba(139, 92, 246, 0.1);
        }

        .step-item {
            padding: 10px 12px;
            background: #0a0a0f;
            border-radius: 6px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .step-item:hover {
            background: #18181b;
            border-color: #3f3f46;
        }

        .step-item.active {
            background: #1e1b4b;
            border-color: #8b5cf6;
        }

        .step-item.running {
            border-color: #60a5fa;
            animation: stepPulse 1s infinite;
        }

        .step-item.replace-target {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        @keyframes stepPulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(96, 165, 250, 0.4);
            }

            50% {
                box-shadow: 0 0 0 4px rgba(96, 165, 250, 0);
            }
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .step-number {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            background: #27272a;
            color: #a1a1aa;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-type {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .type-navigate {
            background: #1e3a5f;
            color: #60a5fa;
        }

        .type-fill {
            background: #365314;
            color: #a3e635;
        }

        .type-click {
            background: #4c1d95;
            color: #c4b5fd;
        }

        .type-assert {
            background: #713f12;
            color: #fbbf24;
        }

        .type-loop {
            background: #831843;
            color: #f9a8d4;
        }

        .step-description {
            font-size: 12px;
            color: #a1a1aa;
            margin-bottom: 8px;
        }

        .step-code {
            background: #0a0a0f;
            border: 1px solid #27272a;
            border-radius: 4px;
            padding: 8px;
            font-family: 'Fira Code', monospace;
            font-size: 11px;
            color: #a78bfa;
            overflow-x: auto;
        }

        .step-actions {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .step-action-btn {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #3f3f46;
            background: #27272a;
            color: #a1a1aa;
            font-size: 11px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .step-action-btn:hover {
            background: #3f3f46;
            color: #e4e4e7;
        }

        .step-action-btn.btn-replace {
            border-color: #f59e0b;
            color: #fbbf24;
        }

        .step-action-btn.btn-replace:hover {
            background: rgba(245, 158, 11, 0.2);
        }

        /* Test Card Actions */
        .test-card-actions {
            padding: 12px;
            border-top: 1px solid #27272a;
            display: none;
            gap: 8px;
        }

        .test-card.expanded .test-card-actions {
            display: flex;
        }

        /* Prompt Input Panel */
        .prompt-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 420px;
            background: #18181b;
            border-top: 1px solid #3f3f46;
            padding: 16px;
            transform: translateY(100%);
            transition: transform 0.3s;
            z-index: 500;
        }

        .prompt-panel.visible {
            transform: translateY(0);
        }

        .prompt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .prompt-header h4 {
            font-size: 13px;
            font-weight: 600;
            color: #a78bfa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prompt-input-wrapper {
            display: flex;
            gap: 8px;
        }

        .prompt-input {
            flex: 1;
            background: #0a0a0f;
            border: 1px solid #3f3f46;
            border-radius: 8px;
            padding: 12px 16px;
            color: #e4e4e7;
            font-size: 14px;
            resize: none;
        }

        .prompt-input:focus {
            outline: none;
            border-color: #8b5cf6;
        }

        .prompt-input::placeholder {
            color: #71717a;
        }

        .prompt-examples {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .prompt-example {
            padding: 6px 12px;
            background: #27272a;
            border: 1px solid #3f3f46;
            border-radius: 20px;
            font-size: 11px;
            color: #a1a1aa;
            cursor: pointer;
            transition: all 0.2s;
        }

        .prompt-example:hover {
            background: #3f3f46;
            color: #e4e4e7;
            border-color: #8b5cf6;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1c1c21;
            border: 1px solid #27272a;
            border-radius: 8px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 3000;
        }

        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: #22c55e;
        }

        .toast.success .toast-icon {
            color: #22c55e;
        }

        .toast.info {
            border-color: #8b5cf6;
        }

        .toast.info .toast-icon {
            color: #8b5cf6;
        }

        /* Upload Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal {
            background: #1c1c21;
            border: 1px solid #27272a;
            border-radius: 12px;
            width: 500px;
            max-height: 80vh;
            overflow: hidden;
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid #27272a;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h2 {
            font-size: 16px;
            font-weight: 600;
        }

        .modal-body {
            padding: 20px;
        }

        .upload-zone {
            border: 2px dashed #3f3f46;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .upload-zone:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.05);
        }

        .upload-zone svg {
            width: 48px;
            height: 48px;
            color: #71717a;
            margin-bottom: 12px;
        }

        .upload-zone p {
            color: #a1a1aa;
            font-size: 14px;
        }

        .upload-zone span {
            color: #8b5cf6;
            cursor: pointer;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid #27272a;
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Element highlight for replace mode */
        .element-highlight {
            position: absolute;
            border: 2px solid #f59e0b;
            background: rgba(245, 158, 11, 0.2);
            pointer-events: none;
            z-index: 50;
            border-radius: 4px;
            display: none;
        }

        .element-highlight.visible {
            display: block;
        }
    </style>
</head>

<body>
    <!-- Toolbar -->
    <div class="toolbar">
        <div class="toolbar-title">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z" />
                <path d="M2 17l10 5 10-5" />
                <path d="M2 12l10 5 10-5" />
            </svg>
            AI Test Recorder
        </div>

        <button class="btn btn-secondary" id="uploadBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="17 8 12 3 7 8" />
                <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            Upload Excel
        </button>

        <button class="btn btn-primary" id="generateBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3" />
            </svg>
            Generate Tests
        </button>

        <button class="btn btn-secondary" id="cancelReplaceBtn" style="display: none;">
            Cancel Replace Mode
        </button>

        <div class="toolbar-spacer"></div>

        <div class="status-badge status-idle" id="statusBadge">
            <span class="pulse"></span>
            <span id="statusText">Idle</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Browser Panel -->
        <div class="browser-panel">
            <div class="browser-header">
                <div class="browser-dots">
                    <div class="browser-dot dot-red"></div>
                    <div class="browser-dot dot-yellow"></div>
                    <div class="browser-dot dot-green"></div>
                </div>
                <input type="text" class="url-bar" value="https://demo-app.example.com/login" readonly>
            </div>
            <div class="browser-viewport" id="browserViewport">
                <!-- Mock Website -->
                <div class="mock-site">
                    <div class="mock-logo" data-element="logo">ðŸš€ DemoApp</div>
                    <div class="mock-form">
                        <h2 data-element="title">Sign In</h2>
                        <input type="text" class="mock-input hoverable" id="emailInput" data-element="email"
                            placeholder="Email address">
                        <input type="password" class="mock-input hoverable" id="passwordInput" data-element="password"
                            placeholder="Password">
                        <button class="mock-btn hoverable" id="loginBtn" data-element="login">Sign In</button>
                        <a class="mock-link hoverable" id="forgotLink" data-element="forgot">Forgot Password?</a>
                    </div>
                </div>

                <!-- AI Cursor -->
                <div class="ai-cursor" id="aiCursor">
                    <svg viewBox="0 0 24 24" fill="#8b5cf6" stroke="#fff" stroke-width="1">
                        <path d="M4 4l16 8-8 3-3 8z" />
                    </svg>
                    <div class="ai-cursor-label" id="cursorLabel">AI Agent</div>
                </div>

                <!-- Element highlight for replace mode -->
                <div class="element-highlight" id="elementHighlight"></div>
            </div>
        </div>

        <!-- Tests Panel -->
        <div class="tests-panel" id="testsPanel">
            <div class="tests-header">
                <h3>Generated Tests</h3>
                <button class="close-btn" id="closePanelBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="tests-list" id="testsList"></div>
        </div>
    </div>

    <!-- Prompt Panel for adding/editing steps -->
    <div class="prompt-panel" id="promptPanel">
        <div class="prompt-header">
            <h4>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
                <span id="promptTitle">Add New Step</span>
            </h4>
            <button class="close-btn" id="closePromptBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            </button>
        </div>
        <div class="prompt-input-wrapper">
            <textarea class="prompt-input" id="promptInput" rows="2"
                placeholder="Describe the step you want to add... e.g., 'Click on forgot password link' or 'Create a loop that iterates through each user in the list'"></textarea>
            <button class="btn btn-primary" id="submitPromptBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 2L11 13" />
                    <path d="M22 2l-7 20-4-9-9-4 20-7z" />
                </svg>
                Generate
            </button>
        </div>
        <div class="prompt-examples">
            <span class="prompt-example" data-prompt="Click on the login button">Click on element</span>
            <span class="prompt-example" data-prompt="Fill the email field with 'test@example.com'">Fill input
                field</span>
            <span class="prompt-example"
                data-prompt="Create a loop that iterates through users array and fills each user's data">Create a
                loop</span>
            <span class="prompt-example"
                data-prompt="Assert that the error message 'Invalid credentials' is visible">Add assertion</span>
            <span class="prompt-example" data-prompt="Wait for the dashboard to load">Wait for element</span>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <h2>Upload Test Cases</h2>
                <button class="close-btn" id="closeModalBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" id="uploadZone">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg>
                    <p>Drag & drop your Excel file here, or <span>browse</span></p>
                    <p style="font-size: 12px; color: #71717a; margin-top: 8px;">
                        Format: Test Case Name | Step 1 | Step 2 | Step 3 | ...
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelUploadBtn">Cancel</button>
                <button class="btn btn-primary" id="importBtn">Import & Generate</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast-icon">âœ“</span>
        <span class="toast-message" id="toastMessage">Success!</span>
    </div>

    <script>
        // Sample test data
        const sampleTests = [
            {
                id: 'TC-001',
                name: 'User Login Flow',
                status: 'complete',
                steps: [
                    { type: 'navigate', desc: 'Navigate to login page', code: 'Navigate to "https://demo-app.example.com/login"' },
                    { type: 'fill', desc: 'Enter email address', code: 'Fill "Email address" with "user@test.com"' },
                    { type: 'fill', desc: 'Enter password', code: 'Fill "Password" with "secretpass"' },
                    { type: 'click', desc: 'Click sign in button', code: 'Click on "Sign In"' },
                    { type: 'assert', desc: 'Verify dashboard visible', code: 'Assert "Dashboard" is visible' }
                ]
            },
            {
                id: 'TC-002',
                name: 'Password Reset Request',
                status: 'pending',
                steps: [
                    { type: 'navigate', desc: 'Navigate to login page', code: 'Navigate to "https://demo-app.example.com/login"' },
                    { type: 'click', desc: 'Click forgot password', code: 'Click on "Forgot Password?"' },
                    { type: 'fill', desc: 'Enter email for reset', code: 'Fill "Email" with "user@test.com"' },
                    { type: 'click', desc: 'Submit reset request', code: 'Click on "Send Reset Link"' }
                ]
            }
        ];

        // State
        let currentTests = [];
        let isGenerating = false;
        let replaceMode = { active: false, testId: null, stepIndex: null };
        let addStepMode = { active: false, testId: null, afterIndex: null };

        // DOM Elements
        const browserViewport = document.getElementById('browserViewport');
        const uploadBtn = document.getElementById('uploadBtn');
        const generateBtn = document.getElementById('generateBtn');
        const cancelReplaceBtn = document.getElementById('cancelReplaceBtn');
        const uploadModal = document.getElementById('uploadModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelUploadBtn = document.getElementById('cancelUploadBtn');
        const importBtn = document.getElementById('importBtn');
        const testsList = document.getElementById('testsList');
        const testsPanel = document.getElementById('testsPanel');
        const closePanelBtn = document.getElementById('closePanelBtn');
        const statusBadge = document.getElementById('statusBadge');
        const statusText = document.getElementById('statusText');
        const aiCursor = document.getElementById('aiCursor');
        const cursorLabel = document.getElementById('cursorLabel');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const promptPanel = document.getElementById('promptPanel');
        const promptInput = document.getElementById('promptInput');
        const promptTitle = document.getElementById('promptTitle');
        const closePromptBtn = document.getElementById('closePromptBtn');
        const submitPromptBtn = document.getElementById('submitPromptBtn');
        const elementHighlight = document.getElementById('elementHighlight');

        // Render test cards with ADD STEP buttons between steps
        function renderTests() {
            testsList.innerHTML = currentTests.map((test, idx) => `
                <div class="test-card ${idx === 0 ? 'expanded active' : ''}" data-id="${test.id}">
                    <div class="test-card-header" onclick="toggleTest('${test.id}')">
                        <div class="test-status-icon ${getStatusClass(test.status)}">
                            ${getStatusIcon(test.status)}
                        </div>
                        <div class="test-card-title">${test.id}: ${test.name}</div>
                        <svg class="expand-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"/>
                        </svg>
                    </div>
                    <div class="test-steps">
                        <!-- Add step at beginning -->
                        <div class="add-step-row">
                            <button class="add-step-btn" onclick="openAddStep('${test.id}', -1)">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                Add step here
                            </button>
                        </div>
                        
                        ${test.steps.map((step, i) => `
                            <div class="step-item ${replaceMode.active && replaceMode.testId === test.id && replaceMode.stepIndex === i ? 'replace-target' : ''}" 
                                 data-test="${test.id}" data-step="${i}"
                                 onclick="selectStep('${test.id}', ${i})">
                                <div class="step-header">
                                    <div class="step-number">${i + 1}</div>
                                    <div class="step-type type-${step.type}">${step.type}</div>
                                </div>
                                <div class="step-description">${step.desc}</div>
                                <div class="step-code">${step.code}</div>
                                <div class="step-actions">
                                    <button class="step-action-btn" onclick="event.stopPropagation(); playStep('${test.id}', ${i})">
                                        â–¶ Run
                                    </button>
                                    <button class="step-action-btn btn-replace" onclick="event.stopPropagation(); startReplaceMode('${test.id}', ${i})">
                                        ðŸ”„ Replace
                                    </button>
                                    <button class="step-action-btn" onclick="event.stopPropagation(); navigateToStep('${test.id}', ${i})">
                                        â†— Navigate
                                    </button>
                                    <button class="step-action-btn" onclick="event.stopPropagation(); deleteStep('${test.id}', ${i})">
                                        ðŸ—‘
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Add step after this one -->
                            <div class="add-step-row">
                                <button class="add-step-btn" onclick="openAddStep('${test.id}', ${i})">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"/>
                                        <line x1="5" y1="12" x2="19" y2="12"/>
                                    </svg>
                                    Add step here
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    <div class="test-card-actions">
                        <button class="btn btn-secondary" style="flex:1" onclick="runTest('${test.id}')">
                            â–¶ Run Test
                        </button>
                        <button class="btn btn-success" style="flex:1" onclick="approveTest('${test.id}')">
                            âœ“ Approve
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getStatusClass(status) {
            return { 'pending': 'status-pending', 'running': 'status-running-icon', 'complete': 'status-complete', 'failed': 'status-failed' }[status] || 'status-pending';
        }

        function getStatusIcon(status) {
            return { 'pending': 'â—‹', 'running': 'â—', 'complete': 'âœ“', 'failed': 'âœ—' }[status] || 'â—‹';
        }

        function toggleTest(id) {
            const card = document.querySelector(`.test-card[data-id="${id}"]`);
            card.classList.toggle('expanded');
        }

        function selectStep(testId, stepIndex) {
            document.querySelectorAll('.step-item').forEach(el => el.classList.remove('active'));
            const stepEl = document.querySelector(`.step-item[data-test="${testId}"][data-step="${stepIndex}"]`);
            if (stepEl) stepEl.classList.add('active');
        }

        // ADD STEP functionality
        function openAddStep(testId, afterIndex) {
            addStepMode = { active: true, testId, afterIndex };
            promptTitle.textContent = afterIndex === -1 ? 'Add Step at Beginning' : `Add Step After Step ${afterIndex + 1}`;
            promptPanel.classList.add('visible');
            promptInput.focus();
            showToast('Enter your step description or use a template', 'info');
        }

        // REPLACE step functionality
        function startReplaceMode(testId, stepIndex) {
            replaceMode = { active: true, testId, stepIndex };
            browserViewport.classList.add('replace-mode');
            cancelReplaceBtn.style.display = 'flex';
            statusBadge.className = 'status-badge status-replace';
            statusText.textContent = 'Replace Mode';
            renderTests();
            showToast('Click on any element in the browser to replace this step', 'info');
        }

        function cancelReplaceModeAction() {
            replaceMode = { active: false, testId: null, stepIndex: null };
            browserViewport.classList.remove('replace-mode');
            cancelReplaceBtn.style.display = 'none';
            statusBadge.className = 'status-badge status-idle';
            statusText.textContent = 'Idle';
            elementHighlight.classList.remove('visible');
            renderTests();
        }

        // Handle clicks on browser elements during replace mode
        browserViewport.addEventListener('click', (e) => {
            if (!replaceMode.active) return;

            const target = e.target.closest('[data-element]');
            if (!target) return;

            const elementName = target.dataset.element;
            const elementType = target.tagName.toLowerCase();

            // Determine action type based on element
            let newStep;
            if (elementType === 'input') {
                const placeholder = target.placeholder || elementName;
                newStep = {
                    type: 'fill',
                    desc: `Fill ${placeholder} field`,
                    code: `Fill "${placeholder}" with "value"`
                };
            } else if (elementType === 'button' || elementType === 'a') {
                const text = target.textContent.trim();
                newStep = {
                    type: 'click',
                    desc: `Click on ${text}`,
                    code: `Click on "${text}"`
                };
            } else {
                newStep = {
                    type: 'click',
                    desc: `Click on ${elementName}`,
                    code: `Click on "${elementName}"`
                };
            }

            // Replace the step
            const test = currentTests.find(t => t.id === replaceMode.testId);
            if (test) {
                test.steps[replaceMode.stepIndex] = newStep;
                showToast(`Step replaced with: ${newStep.desc}`, 'success');
            }

            cancelReplaceModeAction();
            renderTests();
        });

        // Highlight elements on hover during replace mode
        browserViewport.addEventListener('mousemove', (e) => {
            if (!replaceMode.active) return;

            const target = e.target.closest('[data-element]');
            if (target) {
                const rect = target.getBoundingClientRect();
                const viewportRect = browserViewport.getBoundingClientRect();
                elementHighlight.style.left = (rect.left - viewportRect.left) + 'px';
                elementHighlight.style.top = (rect.top - viewportRect.top) + 'px';
                elementHighlight.style.width = rect.width + 'px';
                elementHighlight.style.height = rect.height + 'px';
                elementHighlight.classList.add('visible');
            } else {
                elementHighlight.classList.remove('visible');
            }
        });

        // Submit prompt for new step
        submitPromptBtn.addEventListener('click', () => {
            const promptText = promptInput.value.trim();
            if (!promptText || !addStepMode.active) return;

            // Simulate AI generating a step from the prompt
            let newStep;
            const lowerPrompt = promptText.toLowerCase();

            if (lowerPrompt.includes('loop') || lowerPrompt.includes('iterate')) {
                newStep = {
                    type: 'loop',
                    desc: 'Loop through items',
                    code: `For each user in users {\n    Fill "email" with user.email\n    Click on "Submit"\n}`
                };
            } else if (lowerPrompt.includes('click')) {
                const match = promptText.match(/click\s+(?:on\s+)?(?:the\s+)?["']?([^"']+)["']?/i);
                const target = match ? match[1] : 'button';
                newStep = {
                    type: 'click',
                    desc: `Click on ${target}`,
                    code: `Click on "${target}"`
                };
            } else if (lowerPrompt.includes('fill') || lowerPrompt.includes('enter') || lowerPrompt.includes('type')) {
                newStep = {
                    type: 'fill',
                    desc: 'Fill input field',
                    code: `Fill "field" with "value"`
                };
            } else if (lowerPrompt.includes('assert') || lowerPrompt.includes('verify')) {
                newStep = {
                    type: 'assert',
                    desc: 'Verify element is visible',
                    code: `Assert "element" is visible`
                };
            } else if (lowerPrompt.includes('wait')) {
                newStep = {
                    type: 'navigate',
                    desc: 'Wait for element',
                    code: `Wait for "element" to be visible`
                };
            } else {
                newStep = {
                    type: 'click',
                    desc: promptText,
                    code: `// Generated from: ${promptText}`
                };
            }

            // Insert the step
            const test = currentTests.find(t => t.id === addStepMode.testId);
            if (test) {
                const insertIndex = addStepMode.afterIndex + 1;
                test.steps.splice(insertIndex, 0, newStep);
                showToast(`New step added: ${newStep.desc}`, 'success');
            }

            // Close prompt panel
            promptPanel.classList.remove('visible');
            promptInput.value = '';
            addStepMode = { active: false, testId: null, afterIndex: null };
            renderTests();
        });

        // Prompt examples
        document.querySelectorAll('.prompt-example').forEach(el => {
            el.addEventListener('click', () => {
                promptInput.value = el.dataset.prompt;
                promptInput.focus();
            });
        });

        function deleteStep(testId, stepIndex) {
            const test = currentTests.find(t => t.id === testId);
            if (test && test.steps.length > 1) {
                test.steps.splice(stepIndex, 1);
                showToast('Step deleted', 'success');
                renderTests();
            }
        }

        function playStep(testId, stepIndex) {
            showToast(`Running step ${stepIndex + 1}...`, 'info');
        }

        function navigateToStep(testId, stepIndex) {
            showToast('Navigating to step execution point...', 'info');
        }

        function runTest(testId) {
            showToast(`Running full test: ${testId}`, 'info');
        }

        function approveTest(testId) {
            showToast(`Test ${testId} approved and saved to IDE!`, 'success');
            const test = currentTests.find(t => t.id === testId);
            if (test) test.status = 'complete';
            renderTests();
        }

        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = `toast visible ${type}`;
            setTimeout(() => toast.classList.remove('visible'), 3000);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // AI Animation
        async function animateAI(steps) {
            aiCursor.classList.add('visible');

            for (const step of steps) {
                cursorLabel.textContent = step.label;
                aiCursor.style.left = step.x + 'px';
                aiCursor.style.top = step.y + 'px';

                await sleep(600);

                if (step.action === 'fill' && step.element) {
                    step.element.classList.add('highlight');
                    step.element.value = step.value;
                    await sleep(300);
                    step.element.classList.remove('highlight');
                } else if (step.action === 'click' && step.element) {
                    step.element.classList.add('highlight');
                    await sleep(300);
                    step.element.classList.remove('highlight');
                }

                await sleep(400);
            }

            aiCursor.classList.remove('visible');
        }

        async function runGeneration() {
            if (isGenerating) return;
            isGenerating = true;

            statusBadge.className = 'status-badge status-running';
            statusText.textContent = 'Generating...';

            const emailInput = document.getElementById('emailInput');
            const passwordInput = document.getElementById('passwordInput');
            const loginBtn = document.getElementById('loginBtn');
            const viewportRect = browserViewport.getBoundingClientRect();

            const emailRect = emailInput.getBoundingClientRect();
            const passRect = passwordInput.getBoundingClientRect();
            const btnRect = loginBtn.getBoundingClientRect();

            const steps = [
                { label: 'Analyzing...', x: viewportRect.left + 100, y: viewportRect.top + 100, action: 'look' },
                { label: 'Filling email', x: emailRect.left - viewportRect.left + 50, y: emailRect.top - viewportRect.top + 10, action: 'fill', element: emailInput, value: 'user@test.com' },
                { label: 'Filling password', x: passRect.left - viewportRect.left + 50, y: passRect.top - viewportRect.top + 10, action: 'fill', element: passwordInput, value: 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' },
                { label: 'Clicking button', x: btnRect.left - viewportRect.left + 50, y: btnRect.top - viewportRect.top + 10, action: 'click', element: loginBtn }
            ];

            await animateAI(steps);

            currentTests = [...sampleTests];
            currentTests[0].status = 'complete';
            renderTests();

            statusBadge.className = 'status-badge status-success';
            statusText.textContent = 'Complete';
            showToast('Test cases generated successfully!', 'success');
            isGenerating = false;
        }

        // Event Listeners
        uploadBtn.addEventListener('click', () => uploadModal.classList.add('visible'));
        closeModalBtn.addEventListener('click', () => uploadModal.classList.remove('visible'));
        cancelUploadBtn.addEventListener('click', () => uploadModal.classList.remove('visible'));
        closePanelBtn.addEventListener('click', () => testsPanel.classList.toggle('collapsed'));
        closePromptBtn.addEventListener('click', () => {
            promptPanel.classList.remove('visible');
            addStepMode = { active: false, testId: null, afterIndex: null };
        });
        cancelReplaceBtn.addEventListener('click', cancelReplaceModeAction);

        importBtn.addEventListener('click', () => {
            uploadModal.classList.remove('visible');
            runGeneration();
        });

        generateBtn.addEventListener('click', runGeneration);

        renderTests();
    </script>
</body>

</html>