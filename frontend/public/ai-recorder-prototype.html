<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test Recorder - Vero IDE</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root {
            /* Antigravity IDE inspired colors - Space Gray theme */
            --bg-primary: #1a1a1a;
            --bg-secondary: #212121;
            --bg-tertiary: #2a2a2a;
            --bg-elevated: #333333;
            --border: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(255, 255, 255, 0.2);
            --text-primary: #e8e8e8;
            --text-secondary: #a0a0a0;
            --text-muted: #6b6b6b;
            /* Accent: Warm beige/sand tones */
            --accent-primary: #d4a574;
            --accent-secondary: #e5c9a8;
            --accent-glow: rgba(212, 165, 116, 0.25);
            /* Status colors */
            --success: #7cb342;
            --warning: #ffb74d;
            --error: #e57373;
            --info: #64b5f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* Glassmorphism card */
        .glass {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
        }

        /* Toolbar */
        .toolbar {
            height: 56px;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 16px;
        }

        .toolbar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 15px;
            background: linear-gradient(135deg, var(--accent-primary), #c9a86c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .toolbar-logo .material-icons-round {
            font-size: 24px;
            background: linear-gradient(135deg, var(--accent-primary), #c9a86c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn {
            padding: 10px 18px;
            border-radius: 10px;
            border: none;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
        }

        .btn .material-icons-round {
            font-size: 18px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary) 0%, #b8956e 100%);
            color: white;
            box-shadow: 0 4px 14px var(--accent-glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--accent-glow);
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-hover);
            color: var(--text-primary);
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toolbar-spacer {
            flex: 1;
        }

        /* Environment Selector */
        .env-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .env-selector:hover {
            border-color: var(--accent-primary);
        }

        .env-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .env-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Status Badge */
        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-idle {
            background: var(--bg-elevated);
            color: var(--text-muted);
        }

        .status-running {
            background: rgba(59, 130, 246, 0.15);
            color: var(--info);
        }

        .status-success {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }

        .status-replace {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent-secondary);
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.3);
            }
        }

        /* Main Layout */
        .main-content {
            display: flex;
            height: calc(100vh - 56px);
        }

        /* Browser Panel */
        .browser-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
        }

        .browser-chrome {
            height: 44px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 12px;
        }

        .browser-dots {
            display: flex;
            gap: 8px;
        }

        .browser-dots span {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .browser-dots span:hover {
            transform: scale(1.2);
        }

        .dot-close {
            background: #ff5f57;
        }

        .dot-min {
            background: #febc2e;
        }

        .dot-max {
            background: #28c840;
        }

        .url-bar {
            flex: 1;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 14px;
            color: var(--text-secondary);
            font-size: 12px;
            font-family: 'JetBrains Mono', monospace;
        }

        .browser-viewport {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .browser-viewport.replace-mode {
            cursor: crosshair;
        }

        .browser-viewport.replace-mode::before {
            content: '';
            position: absolute;
            inset: 0;
            border: 3px solid var(--accent-primary);
            pointer-events: none;
            z-index: 100;
            animation: borderPulse 1.5s infinite;
        }

        @keyframes borderPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .replace-hint {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent-primary), #c9a86c);
            color: white;
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 600;
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 101;
            box-shadow: 0 8px 24px var(--accent-glow);
        }

        .browser-viewport.replace-mode .replace-hint {
            display: flex;
        }

        /* Mock Site */
        .mock-site {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .mock-logo {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 40px;
            background: linear-gradient(135deg, var(--accent-primary), #c9a86c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .mock-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            width: 380px;
            backdrop-filter: blur(20px);
        }

        .mock-card h2 {
            text-align: center;
            font-size: 22px;
            margin-bottom: 28px;
            color: var(--text-primary);
        }

        .mock-input {
            width: 100%;
            padding: 14px 18px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 16px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .mock-input:focus,
        .mock-input.highlight {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 4px var(--accent-glow);
        }

        .mock-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, #b8956e 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .mock-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--accent-glow);
        }

        .mock-link {
            display: block;
            text-align: center;
            color: var(--accent-secondary);
            font-size: 13px;
            margin-top: 20px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .mock-link:hover {
            color: var(--accent-primary);
        }

        /* Element Highlight */
        .element-highlight {
            position: absolute;
            border: 2px solid var(--warning);
            background: rgba(245, 158, 11, 0.15);
            pointer-events: none;
            z-index: 50;
            border-radius: 8px;
            display: none;
            transition: all 0.15s;
        }

        .element-highlight.visible {
            display: block;
        }

        /* Tests Panel */
        .tests-panel {
            width: 420px;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
        }

        .tests-header {
            height: 56px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }

        .tests-header h3 {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tests-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Test Card */
        .test-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-bottom: 12px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .test-card:hover {
            border-color: var(--border-hover);
        }

        .test-card.active {
            border-color: var(--accent-primary);
        }

        .test-card-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* PLAY BUTTON - Round FAB style */
        .play-fab {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary) 0%, #b8956e 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 14px var(--accent-glow);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            flex-shrink: 0;
        }

        .play-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px var(--accent-glow);
        }

        .play-fab:active {
            transform: scale(0.95);
        }

        .play-fab .material-icons-round {
            font-size: 22px;
        }

        .test-card-info {
            flex: 1;
            min-width: 0;
        }

        .test-card-id {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent-secondary);
            margin-bottom: 4px;
        }

        .test-card-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .test-status-chip {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .chip-pending {
            background: var(--bg-elevated);
            color: var(--text-muted);
        }

        .chip-complete {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }

        .chip-running {
            background: rgba(59, 130, 246, 0.15);
            color: var(--info);
        }

        .expand-toggle {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .expand-toggle:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .test-card.expanded .expand-toggle .material-icons-round {
            transform: rotate(180deg);
        }

        /* Test Steps */
        .test-steps {
            display: none;
            padding: 0 16px 16px;
        }

        .test-card.expanded .test-steps {
            display: block;
        }

        .add-step-btn {
            width: 100%;
            padding: 10px;
            border: 1px dashed var(--border);
            border-radius: 10px;
            background: transparent;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin: 8px 0;
            opacity: 0;
            transition: all 0.2s;
            font-family: inherit;
        }

        .test-steps:hover .add-step-btn {
            opacity: 1;
        }

        .add-step-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-secondary);
            background: rgba(139, 92, 246, 0.05);
        }

        .step-item {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .step-item:hover {
            border-color: var(--border-hover);
        }

        .step-item.active {
            border-color: var(--accent-primary);
            background: rgba(139, 92, 246, 0.05);
        }

        .step-item.replace-target {
            border-color: var(--warning);
            background: rgba(245, 158, 11, 0.05);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .step-num {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: var(--bg-elevated);
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-type {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .type-navigate {
            background: rgba(59, 130, 246, 0.15);
            color: var(--info);
        }

        .type-fill {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }

        .type-click {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent-secondary);
        }

        .type-assert {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .type-loop {
            background: rgba(236, 72, 153, 0.15);
            color: #c9a86c;
        }

        .step-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .step-code {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--accent-secondary);
            overflow-x: auto;
        }

        .step-actions {
            display: flex;
            gap: 6px;
            margin-top: 10px;
        }

        .step-action {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid var(--border);
            background: var(--bg-elevated);
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .step-action:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .step-action .material-icons-round {
            font-size: 14px;
        }

        .step-action.btn-replace {
            border-color: var(--warning);
            color: var(--warning);
        }

        .step-action.btn-replace:hover {
            background: rgba(245, 158, 11, 0.1);
        }

        /* Card Actions */
        .test-card-actions {
            display: none;
            padding: 16px;
            border-top: 1px solid var(--border);
            gap: 10px;
        }

        .test-card.expanded .test-card-actions {
            display: flex;
        }

        /* Prompt Panel */
        .prompt-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 420px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 500;
        }

        .prompt-panel.visible {
            transform: translateY(0);
        }

        .prompt-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .prompt-header h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prompt-input-row {
            display: flex;
            gap: 12px;
        }

        .prompt-input {
            flex: 1;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px 18px;
            color: var(--text-primary);
            font-size: 14px;
            resize: none;
            font-family: inherit;
        }

        .prompt-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .prompt-chips {
            display: flex;
            gap: 8px;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .chip {
            padding: 8px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .chip:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(120px);
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 3000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.info {
            border-color: var(--accent-primary);
        }

        .toast .material-icons-round {
            font-size: 20px;
        }

        .toast.success .material-icons-round {
            color: var(--success);
        }

        .toast.info .material-icons-round {
            color: var(--accent-primary);
        }

        /* Environment Modal */
        .env-modal {
            position: fixed;
            top: 70px;
            right: 440px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            width: 280px;
            display: none;
            z-index: 1000;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .env-modal.visible {
            display: block;
        }

        .env-modal h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 14px;
            color: var(--text-secondary);
        }

        .env-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 6px;
        }

        .env-option:hover {
            background: var(--bg-elevated);
        }

        .env-option.active {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid var(--accent-primary);
        }

        .env-option-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .env-option-info {
            flex: 1;
        }

        .env-option-name {
            font-size: 13px;
            font-weight: 500;
        }

        .env-option-url {
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-hover);
        }

        /* Quick Create Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .quick-create-modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h2 {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-header h2 .material-icons-round {
            font-size: 22px;
            background: linear-gradient(135deg, var(--accent-primary), #c9a86c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .qc-input-group {
            margin-bottom: 20px;
        }

        .qc-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .qc-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .qc-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .qc-steps-area {
            width: 100%;
            min-height: 200px;
            padding: 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.8;
            resize: none;
            transition: all 0.2s;
        }

        .qc-steps-area:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .qc-steps-area::placeholder {
            color: var(--text-muted);
        }

        .qc-templates {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .qc-template {
            padding: 8px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .qc-template:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .qc-template .material-icons-round {
            font-size: 14px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-footer .btn {
            flex: 1;
            justify-content: center;
        }

        .qc-hint {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 12px;
            color: var(--accent-secondary);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .qc-hint .material-icons-round {
            font-size: 18px;
            flex-shrink: 0;
        }
    </style>
</head>

<body>
    <!-- Toolbar -->
    <div class="toolbar">
        <div class="toolbar-logo">
            <span class="material-icons-round">psychology</span>
            AI Test Recorder
        </div>

        <button class="btn btn-secondary" id="uploadBtn">
            <span class="material-icons-round">upload_file</span>
            Import Excel
        </button>

        <button class="btn btn-primary" id="quickCreateBtn">
            <span class="material-icons-round">edit_note</span>
            Quick Create
        </button>

        <button class="btn btn-secondary" id="generateBtn">
            <span class="material-icons-round">auto_awesome</span>
            Generate Tests
        </button>

        <button class="btn btn-secondary" id="cancelReplaceBtn" style="display: none;">
            <span class="material-icons-round">close</span>
            Cancel
        </button>

        <div class="toolbar-spacer"></div>

        <div class="env-selector" id="envSelector">
            <div class="env-dot" id="envDot"></div>
            <span class="env-name" id="envName">Production</span>
            <span class="material-icons-round" style="font-size: 18px; color: var(--text-muted);">expand_more</span>
        </div>

        <div class="status-badge status-idle" id="statusBadge">
            <span class="pulse-dot"></span>
            <span id="statusText">Ready</span>
        </div>
    </div>

    <!-- Env Modal -->
    <div class="env-modal" id="envModal">
        <h4>Select Environment</h4>
        <div class="env-option active" data-env="production" data-color="#22c55e" data-url="https://app.example.com">
            <div class="env-option-dot" style="background: #22c55e;"></div>
            <div class="env-option-info">
                <div class="env-option-name">Production</div>
                <div class="env-option-url">https://app.example.com</div>
            </div>
        </div>
        <div class="env-option" data-env="staging" data-color="#f59e0b" data-url="https://staging.example.com">
            <div class="env-option-dot" style="background: #f59e0b;"></div>
            <div class="env-option-info">
                <div class="env-option-name">Staging</div>
                <div class="env-option-url">https://staging.example.com</div>
            </div>
        </div>
        <div class="env-option" data-env="local" data-color="#3b82f6" data-url="http://localhost:3000">
            <div class="env-option-dot" style="background: #3b82f6;"></div>
            <div class="env-option-info">
                <div class="env-option-name">Local</div>
                <div class="env-option-url">http://localhost:3000</div>
            </div>
        </div>
    </div>

    <!-- Main -->
    <div class="main-content">
        <div class="browser-panel">
            <div class="browser-chrome">
                <div class="browser-dots">
                    <span class="dot-close"></span>
                    <span class="dot-min"></span>
                    <span class="dot-max"></span>
                </div>
                <input type="text" class="url-bar" id="urlBar" value="https://app.example.com/login" readonly>
            </div>
            <div class="browser-viewport" id="browserViewport">
                <div class="replace-hint">
                    <span class="material-icons-round">touch_app</span>
                    Click element to replace step
                </div>
                <div class="mock-site">
                    <div class="mock-logo">âœ¨ DemoApp</div>
                    <div class="mock-card">
                        <h2>Welcome Back</h2>
                        <input type="text" class="mock-input" id="emailInput" data-element="email" placeholder="Email">
                        <input type="password" class="mock-input" id="passwordInput" data-element="password"
                            placeholder="Password">
                        <button class="mock-btn" id="loginBtn" data-element="login">Sign In</button>
                        <a class="mock-link" id="forgotLink" data-element="forgot">Forgot password?</a>
                    </div>
                </div>
                <div class="element-highlight" id="elementHighlight"></div>
            </div>
        </div>

        <div class="tests-panel" id="testsPanel">
            <div class="tests-header">
                <h3><span class="material-icons-round" style="font-size: 18px;">checklist</span> Generated Tests</h3>
            </div>
            <div class="tests-list" id="testsList"></div>
        </div>
    </div>

    <!-- Prompt Panel -->
    <div class="prompt-panel" id="promptPanel">
        <div class="prompt-header">
            <h4><span class="material-icons-round">chat</span> <span id="promptTitle">Add Step</span></h4>
            <button class="btn btn-icon btn-secondary" id="closePromptBtn">
                <span class="material-icons-round">close</span>
            </button>
        </div>
        <div class="prompt-input-row">
            <textarea class="prompt-input" id="promptInput" rows="2"
                placeholder="Describe the step... e.g. 'Click login' or 'Loop through users'"></textarea>
            <button class="btn btn-primary" id="submitPromptBtn">
                <span class="material-icons-round">send</span>
            </button>
        </div>
        <div class="prompt-chips">
            <span class="chip" data-prompt="Click on the login button">Click element</span>
            <span class="chip" data-prompt="Fill email with 'test@example.com'">Fill field</span>
            <span class="chip" data-prompt="Create a loop for each user">Create loop</span>
            <span class="chip" data-prompt="Assert dashboard is visible">Assert</span>
        </div>
    </div>

    <div class="toast" id="toast">
        <span class="material-icons-round">check_circle</span>
        <span id="toastMessage">Success!</span>
    </div>

    <!-- Quick Create Modal -->
    <div class="modal-overlay" id="quickCreateModal">
        <div class="quick-create-modal">
            <div class="modal-header">
                <h2><span class="material-icons-round">bolt</span> Quick Create Test</h2>
                <button class="btn btn-icon btn-secondary" id="closeQCModal">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="qc-hint">
                    <span class="material-icons-round">lightbulb</span>
                    <span>Write your test steps in plain English, one step per line. The AI will convert them into
                        executable Playwright scripts.</span>
                </div>
                <div class="qc-input-group">
                    <label class="qc-label">Test Case Name</label>
                    <input type="text" class="qc-input" id="qcTestName" placeholder="e.g., User Login Flow">
                </div>
                <div class="qc-input-group">
                    <label class="qc-label">Test Steps</label>
                    <textarea class="qc-steps-area" id="qcSteps" rows="8" placeholder="Navigate to the login page
Fill the email field with 'test@example.com'
Fill the password field with 'password123'
Click the Sign In button
Verify the dashboard is visible"></textarea>
                    <div class="qc-templates">
                        <span class="qc-template" data-template="Navigate to the login page">
                            <span class="material-icons-round">open_in_browser</span> Navigate
                        </span>
                        <span class="qc-template" data-template="Fill the email field with 'value'">
                            <span class="material-icons-round">edit</span> Fill
                        </span>
                        <span class="qc-template" data-template="Click the Submit button">
                            <span class="material-icons-round">touch_app</span> Click
                        </span>
                        <span class="qc-template" data-template="Verify the success message is visible">
                            <span class="material-icons-round">check_circle</span> Assert
                        </span>
                        <span class="qc-template" data-template="Loop through each user in the list">
                            <span class="material-icons-round">repeat</span> Loop
                        </span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelQCBtn">
                    <span class="material-icons-round">close</span> Cancel
                </button>
                <button class="btn btn-primary" id="generateQCBtn">
                    <span class="material-icons-round">auto_awesome</span> Generate Test
                </button>
            </div>
        </div>
    </div>

    <script>
        const sampleTests = [
            {
                id: 'TC-001', name: 'User Login Flow', status: 'complete', steps: [
                    { type: 'navigate', desc: 'Navigate to login', code: 'Navigate to "${baseUrl}/login"' },
                    { type: 'fill', desc: 'Enter email', code: 'Fill "Email" with "user@test.com"' },
                    { type: 'fill', desc: 'Enter password', code: 'Fill "Password" with "secret"' },
                    { type: 'click', desc: 'Click sign in', code: 'Click on "Sign In"' },
                    { type: 'assert', desc: 'Verify dashboard', code: 'Assert "Dashboard" is visible' }
                ]
            },
            {
                id: 'TC-002', name: 'Password Reset', status: 'pending', steps: [
                    { type: 'navigate', desc: 'Go to login', code: 'Navigate to "${baseUrl}/login"' },
                    { type: 'click', desc: 'Click forgot password', code: 'Click on "Forgot password?"' },
                    { type: 'fill', desc: 'Enter email', code: 'Fill "Email" with "user@test.com"' }
                ]
            }
        ];

        let currentTests = [];
        let replaceMode = { active: false, testId: null, stepIndex: null };
        let addStepMode = { active: false, testId: null, afterIndex: null };

        const testsList = document.getElementById('testsList');
        const browserViewport = document.getElementById('browserViewport');
        const cancelReplaceBtn = document.getElementById('cancelReplaceBtn');
        const statusBadge = document.getElementById('statusBadge');
        const statusText = document.getElementById('statusText');
        const promptPanel = document.getElementById('promptPanel');
        const promptInput = document.getElementById('promptInput');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const elementHighlight = document.getElementById('elementHighlight');
        const envSelector = document.getElementById('envSelector');
        const envModal = document.getElementById('envModal');
        const envDot = document.getElementById('envDot');
        const envName = document.getElementById('envName');
        const urlBar = document.getElementById('urlBar');

        function renderTests() {
            testsList.innerHTML = currentTests.map((test, idx) => `
                <div class="test-card ${idx === 0 ? 'expanded active' : ''}" data-id="${test.id}">
                    <div class="test-card-header">
                        <button class="play-fab" onclick="event.stopPropagation(); runGeneratedScript('${test.id}')" title="Run generated script">
                            <span class="material-icons-round">play_arrow</span>
                        </button>
                        <div class="test-card-info" onclick="toggleTest('${test.id}')">
                            <div class="test-card-id">${test.id}</div>
                            <div class="test-card-title">${test.name}</div>
                        </div>
                        <span class="test-status-chip chip-${test.status}">${test.status}</span>
                        <button class="expand-toggle" onclick="toggleTest('${test.id}')">
                            <span class="material-icons-round">expand_more</span>
                        </button>
                    </div>
                    <div class="test-steps">
                        <button class="add-step-btn" onclick="openAddStep('${test.id}', -1)">
                            <span class="material-icons-round" style="font-size: 16px;">add</span> Add step
                        </button>
                        ${test.steps.map((step, i) => `
                            <div class="step-item ${replaceMode.active && replaceMode.testId === test.id && replaceMode.stepIndex === i ? 'replace-target' : ''}" data-test="${test.id}" data-step="${i}">
                                <div class="step-header">
                                    <div class="step-num">${i + 1}</div>
                                    <span class="step-type type-${step.type}">${step.type}</span>
                                </div>
                                <div class="step-desc">${step.desc}</div>
                                <div class="step-code">${step.code}</div>
                                <div class="step-actions">
                                    <button class="step-action" onclick="event.stopPropagation(); playStep('${test.id}', ${i})">
                                        <span class="material-icons-round">play_arrow</span> Run
                                    </button>
                                    <button class="step-action btn-replace" onclick="event.stopPropagation(); startReplaceMode('${test.id}', ${i})">
                                        <span class="material-icons-round">swap_horiz</span> Replace
                                    </button>
                                    <button class="step-action" onclick="event.stopPropagation(); deleteStep('${test.id}', ${i})">
                                        <span class="material-icons-round">delete</span>
                                    </button>
                                </div>
                            </div>
                            <button class="add-step-btn" onclick="openAddStep('${test.id}', ${i})">
                                <span class="material-icons-round" style="font-size: 16px;">add</span> Add step
                            </button>
                        `).join('')}
                    </div>
                    <div class="test-card-actions">
                        <button class="btn btn-secondary" style="flex:1" onclick="runGeneratedScript('${test.id}')">
                            <span class="material-icons-round">play_arrow</span> Run Script
                        </button>
                        <button class="btn btn-primary" style="flex:1" onclick="approveTest('${test.id}')">
                            <span class="material-icons-round">check</span> Approve
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function toggleTest(id) {
            document.querySelector(`.test-card[data-id="${id}"]`).classList.toggle('expanded');
        }

        function runGeneratedScript(testId) {
            const test = currentTests.find(t => t.id === testId);
            showToast(`Running generated Playwright script for ${test.name}...`, 'info');
            // This runs the GENERATED script, not AI
        }

        function openAddStep(testId, afterIndex) {
            addStepMode = { active: true, testId, afterIndex };
            document.getElementById('promptTitle').textContent = `Add Step ${afterIndex === -1 ? 'at Start' : `After Step ${afterIndex + 1}`}`;
            promptPanel.classList.add('visible');
            promptInput.focus();
        }

        function startReplaceMode(testId, stepIndex) {
            replaceMode = { active: true, testId, stepIndex };
            browserViewport.classList.add('replace-mode');
            cancelReplaceBtn.style.display = 'flex';
            statusBadge.className = 'status-badge status-replace';
            statusText.textContent = 'Replace Mode';
            renderTests();
        }

        function cancelReplaceModeAction() {
            replaceMode = { active: false, testId: null, stepIndex: null };
            browserViewport.classList.remove('replace-mode');
            cancelReplaceBtn.style.display = 'none';
            statusBadge.className = 'status-badge status-idle';
            statusText.textContent = 'Ready';
            elementHighlight.classList.remove('visible');
            renderTests();
        }

        browserViewport.addEventListener('click', (e) => {
            if (!replaceMode.active) return;
            const target = e.target.closest('[data-element]');
            if (!target) return;

            const elementType = target.tagName.toLowerCase();
            let newStep;
            if (elementType === 'input') {
                newStep = { type: 'fill', desc: `Fill ${target.placeholder}`, code: `Fill "${target.placeholder}" with "value"` };
            } else {
                const text = target.textContent.trim();
                newStep = { type: 'click', desc: `Click ${text}`, code: `Click on "${text}"` };
            }

            const test = currentTests.find(t => t.id === replaceMode.testId);
            if (test) {
                test.steps[replaceMode.stepIndex] = newStep;
                showToast(`Replaced: ${newStep.desc}`, 'success');
            }
            cancelReplaceModeAction();
            renderTests();
        });

        browserViewport.addEventListener('mousemove', (e) => {
            if (!replaceMode.active) return;
            const target = e.target.closest('[data-element]');
            if (target) {
                const rect = target.getBoundingClientRect();
                const vpRect = browserViewport.getBoundingClientRect();
                elementHighlight.style.cssText = `left:${rect.left - vpRect.left}px;top:${rect.top - vpRect.top}px;width:${rect.width}px;height:${rect.height}px`;
                elementHighlight.classList.add('visible');
            } else {
                elementHighlight.classList.remove('visible');
            }
        });

        document.getElementById('submitPromptBtn').addEventListener('click', () => {
            const text = promptInput.value.trim();
            if (!text || !addStepMode.active) return;

            let newStep;
            const lower = text.toLowerCase();
            if (lower.includes('loop')) {
                newStep = { type: 'loop', desc: 'Loop through items', code: 'For each item in list {\n    // steps\n}' };
            } else if (lower.includes('click')) {
                newStep = { type: 'click', desc: text, code: `Click on "element"` };
            } else if (lower.includes('fill')) {
                newStep = { type: 'fill', desc: text, code: `Fill "field" with "value"` };
            } else {
                newStep = { type: 'click', desc: text, code: `// ${text}` };
            }

            const test = currentTests.find(t => t.id === addStepMode.testId);
            if (test) {
                test.steps.splice(addStepMode.afterIndex + 1, 0, newStep);
                showToast(`Added: ${newStep.desc}`, 'success');
            }

            promptPanel.classList.remove('visible');
            promptInput.value = '';
            addStepMode = { active: false, testId: null, afterIndex: null };
            renderTests();
        });

        document.querySelectorAll('.chip').forEach(el => {
            el.addEventListener('click', () => { promptInput.value = el.dataset.prompt; promptInput.focus(); });
        });

        function deleteStep(testId, stepIndex) {
            const test = currentTests.find(t => t.id === testId);
            if (test && test.steps.length > 1) {
                test.steps.splice(stepIndex, 1);
                showToast('Step deleted', 'success');
                renderTests();
            }
        }

        function playStep(testId, stepIndex) { showToast(`Running step ${stepIndex + 1}...`, 'info'); }
        function approveTest(testId) {
            showToast(`${testId} approved & saved to IDE!`, 'success');
            const test = currentTests.find(t => t.id === testId);
            if (test) test.status = 'complete';
            renderTests();
        }

        function showToast(msg, type = 'success') {
            toastMessage.textContent = msg;
            toast.className = `toast visible ${type}`;
            setTimeout(() => toast.classList.remove('visible'), 3000);
        }

        // Env selector
        envSelector.addEventListener('click', () => envModal.classList.toggle('visible'));
        document.querySelectorAll('.env-option').forEach(opt => {
            opt.addEventListener('click', () => {
                document.querySelectorAll('.env-option').forEach(o => o.classList.remove('active'));
                opt.classList.add('active');
                envDot.style.background = opt.dataset.color;
                envName.textContent = opt.querySelector('.env-option-name').textContent;
                urlBar.value = opt.dataset.url + '/login';
                envModal.classList.remove('visible');
                showToast(`Switched to ${envName.textContent}`, 'info');
            });
        });

        document.getElementById('generateBtn').addEventListener('click', () => {
            currentTests = JSON.parse(JSON.stringify(sampleTests));
            renderTests();
            showToast('Tests generated!', 'success');
        });

        cancelReplaceBtn.addEventListener('click', cancelReplaceModeAction);
        document.getElementById('closePromptBtn').addEventListener('click', () => { promptPanel.classList.remove('visible'); });

        // Quick Create Modal handlers
        const quickCreateModal = document.getElementById('quickCreateModal');
        const qcTestName = document.getElementById('qcTestName');
        const qcSteps = document.getElementById('qcSteps');

        document.getElementById('quickCreateBtn').addEventListener('click', () => {
            quickCreateModal.classList.add('visible');
            qcTestName.focus();
        });

        document.getElementById('closeQCModal').addEventListener('click', () => {
            quickCreateModal.classList.remove('visible');
        });

        document.getElementById('cancelQCBtn').addEventListener('click', () => {
            quickCreateModal.classList.remove('visible');
        });

        // Template chips for quick create
        document.querySelectorAll('.qc-template').forEach(el => {
            el.addEventListener('click', () => {
                const current = qcSteps.value;
                const template = el.dataset.template;
                qcSteps.value = current ? current + '\n' + template : template;
                qcSteps.focus();
            });
        });

        // Generate from quick create
        document.getElementById('generateQCBtn').addEventListener('click', () => {
            const name = qcTestName.value.trim() || 'New Test Case';
            const stepsText = qcSteps.value.trim();

            if (!stepsText) {
                showToast('Please enter at least one step', 'info');
                return;
            }

            const lines = stepsText.split('\n').filter(l => l.trim());
            const steps = lines.map(line => {
                const lower = line.toLowerCase();
                let type = 'click';
                if (lower.includes('navigate') || lower.includes('go to') || lower.includes('open')) {
                    type = 'navigate';
                } else if (lower.includes('fill') || lower.includes('enter') || lower.includes('type')) {
                    type = 'fill';
                } else if (lower.includes('assert') || lower.includes('verify') || lower.includes('check')) {
                    type = 'assert';
                } else if (lower.includes('loop') || lower.includes('each') || lower.includes('iterate')) {
                    type = 'loop';
                } else if (lower.includes('wait')) {
                    type = 'navigate';
                }
                return { type, desc: line, code: `// ${line}` };
            });

            const newTestId = `TC-${String(currentTests.length + 1).padStart(3, '0')}`;
            currentTests.unshift({
                id: newTestId,
                name: name,
                status: 'pending',
                steps: steps
            });

            quickCreateModal.classList.remove('visible');
            qcTestName.value = '';
            qcSteps.value = '';
            renderTests();
            showToast(`Created: ${newTestId} - ${name}`, 'success');
        });

        // Close modal on overlay click
        quickCreateModal.addEventListener('click', (e) => {
            if (e.target === quickCreateModal) {
                quickCreateModal.classList.remove('visible');
            }
        });

        renderTests();
    </script>
</body>

</html>